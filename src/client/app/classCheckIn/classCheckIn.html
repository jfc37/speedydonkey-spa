<div class="row">
    <h1>{{vm.class.name}} Class Check In</h1>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Walk In Students</h3>
        </div>
        <div class="panel-body">
            <div>
                <input type="text" placeholder="Student's Name" ng-model="vm.walkInStudentSelected" typeahead="student as student.full_name for student in vm.searchUsers($viewValue)">
                <button class="btn btn-primary" ng-disabled="!vm.isSelectedStudentValid()" ng-click="vm.addWalkIn()">Add Walk In</button>
                <button class="btn btn-primary" ng-disabled="!vm.isSelectedStudentValid()" ng-click="vm.enrolWalkIn()">Enrol In Block</button>
                <button class="btn btn-primary" ng-disabled="vm.isSelectedStudentValid()" ng-click="vm.createAccount()">Create New Account</button>
            </div>
        </div>
    </div>

    <div class="panel panel-default" ng-show="vm.creatingNewAccount">
        <div class="panel-heading">
            <h3 class="panel-title">New Account</h3>
        </div>
        <div class="panel-body">
            <div ng-include src="'app/register/newUser.html'"></div>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Students</h3>
        </div>
        <div class="panel-body" ng-show="vm.areRegisteredStudentsLoading">
            <p>Loading students...</p>
        </div>
        <div class="panel-body" ng-hide="vm.areRegisteredStudentsLoading">
            <div ng-show="vm.registeredStudents.length === 0">
                No students registered for this class.
            </div>
            <div ng-repeat="student in vm.students track by $index">
                <div class="form-group">
                    <input type="checkbox" data-ng-model="student.attendedClass" data-ng-change="vm.attendenceStatusChanged(student)"> {{student.full_name}}
                    <note ng-model="student" type="user"></note>
                    <pass-status ng-model='student' ng-click="student.openPassSelection = !student.openPassSelection"></pass-status>
                </div>

                <div class="panel panel-default" ng-show="student.openPassSelection">
                    <div class="panel-heading">
                        <h3 class="panel-title">Passes for {{student.full_name}}</h3>
                    </div>
                    <div class="panel-body">
                        <div ng-repeat="pass in student.passes | filter:{payment_status: 'Pending'}">
                            <pass-summary ng-model="pass"></pass-summary>
                            <note ng-model="pass" type="pass"></note>
                            <button class="btn btn-primary" ng-click="vm.passPaidFor(pass, student)">Paid</button>
                        </div>
                        <div ng-repeat="pass in student.passes | filter:{payment_status: 'Paid'}">
                            <pass-summary ng-model="pass"></pass-summary>
                            <note ng-model="pass" type="pass"></note>
                        </div>

                        <hr ng-show="student.passes.length > 0" />
                        <h3>Pass Selection</h3>
                        <div class="radio" data-ng-repeat="pass in vm.passOptions">
                            <label>
                                <input type="radio" name="passOptions" data-ng-model="$parent.selectedPass" ng-value="pass"> {{pass.description}} - ${{pass.cost}}
                            </label>
                        </div>
                        <button ng-disabled="vm.disablePassPurchase" class="btn btn-primary" ng-click="vm.purchaseNewPass(student, selectedPass)">Purchase</button>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Teachers</h3>
        </div>
        <div class="panel-body">
            <teacher-dropdown ng-model="vm.class.teachers"></teacher-dropdown>
            <button class="btn btn-primary" ng-click="vm.updateTeachers()">Update teachers</button>
        </div>
    </div>
</div>
